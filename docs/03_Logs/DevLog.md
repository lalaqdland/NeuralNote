# NeuralNote 开发日志

> 这里是项目的"航海日记"，记录开发过程中的思考、问题和决策。

## 文档规范

- **更新频率**：每天或每次重要开发活动后
- **格式**：
  - 日期标记：`YYYY-MM-DD`
  - 分类标签：`[问题]` `[决策]` `[TODO]` `[灵感]` `[技术债]`
- **重要原则**：只记录真正值得记录的内容，避免水文

---

## 2026年1月

### 2026-01-28 - 项目架构设计决策

#### [决策] 采用 PostgreSQL + JSONB 替代 MongoDB

**问题背景**：

- 需要存储灵活的节点内容（不同类型节点结构不同）
- 同时需要强大的关联查询能力（知识图谱关系）
- 考虑过 MongoDB（灵活文档存储）和 PostgreSQL（JSONB支持）

**最终决策**：PostgreSQL + JSONB + PgVector

**理由**：
1. **统一技术栈**：避免引入新的数据库类型
2. **JSONB能力**：PostgreSQL 15+ 的 JSONB 完全满足灵活存储需求
3. **向量支持**：PgVector 扩展让 PostgreSQL 同时具备向量搜索能力
4. **事务一致性**：复杂操作可以在单事务中完成
5. **生态成熟**：ORM、监控、备份等工具链完善

**权衡**：
- ✅ 减少技术栈复杂度
- ✅ 更好的数据一致性保证
- ⚠️ JSONB 查询性能略低于原生 MongoDB（但可通过索引优化）

**后续行动**：
- 验证 JSONB 索引性能
- 制定 JSONB 查询最佳实践

---

### 2026-01-28 - OCR服务选型决策

#### [决策] 采用多引擎融合策略

**问题背景**：
- 单个OCR服务难以覆盖所有场景（印刷体、手写体、数学公式）
- 需要高准确率（用户上传的题目不能识别错误）

**最终决策**：百度OCR + 腾讯OCR 双引擎 + 结果投票

**分工**：
- **百度OCR**：主引擎，负责通用文字识别
- **腾讯OCR**：辅助引擎，负责手写体和公式识别
- **投票机制**：取置信度最高的结果

**理由**：
1. **互补优势**：百度在印刷体识别强，腾讯在手写体和公式识别强
2. **容错能力**：单个服务故障不影响整体可用性
3. **质量提升**：融合结果准确率 > 单引擎最佳结果

**TODO**：
- [ ] 编写OCR结果融合算法
- [ ] 测试各场景准确率
- [ ] 设置调用限流策略

---

### 2026-01-28 - LLM服务成本控制策略

#### [决策] 采用混合LLM策略（主力DeepSeek，辅助GPT-4）

**问题背景**：
- 产品核心功能（AI解答、知识点提取）依赖LLM
- LLM API调用成本高，需要精细控制

**最终决策**：
- **主力**：DeepSeek（性价比高，中文理解好）
- **兜底/复杂场景**：GPT-4（质量最高）
- **缓存**：相同/相似题目复用分析结果

**理由**：
1. **成本**：DeepSeek 成本约为 GPT-4 的 1/10
2. **效果**：DeepSeek 在中文数学题目理解上表现良好
3. **策略**：简单题目 DeepSeek，复杂题目 GPT-4

**成本优化措施**：
1. **结果缓存**：相同题目（基于哈希）不重复调用
2. **Token优化**：精简提示词，减少无效Token
3. **分级调用**：用户等级决定LLM调用频率限制
4. **批量处理**：用户批量上传时合并处理

**TODO**：
- [ ] 实现题目哈希缓存机制
- [ ] 配置 DeepSeek 和 GPT-4 的调用策略
- [ ] 监控 LLM 调用成本

---

### 2026-01-28 - 知识图谱数据模型设计

#### [决策] 抽象"记忆节点"而非直接使用"题目"

**问题背景**：
- V1阶段主要存储题目，但未来可能扩展到笔记、代码片段等
- 底层数据模型需要具备扩展性

**最终决策**：
- 核心实体：`MemoryNode`（记忆节点）
- V1阶段：`node_type = "QUESTION"`
- 未来扩展：`CONCEPT`, `SNIPPET`, `INSIGHT` 等

**数据结构**：
```python
MemoryNode {
    id: UUID
    node_type: QUESTION  # 灵活可扩展
    content_data: JSONB  # 灵活的载荷数据
    review_stats: JSONB  # 通用复习属性
    # ... 其他通用属性
}
```

**理由**：
1. **解耦设计**：图谱逻辑（关系、位置、复习状态）与业务内容分离
2. **未来扩展**：无需重构图谱和复习系统即可支持新类型
3. **统一接口**：复习、图谱展示等模块只需处理 MemoryNode

**TODO**：
- [ ] 实现 MemoryNode CRUD 接口
- [ ] 编写类型转换逻辑
- [ ] 测试 JSONB 查询性能

---

### 2026-01-28 - 复习算法选择

#### [决策] 基于 SM-2 的遗忘曲线算法

**问题背景**：
- 用户需要智能的复习提醒
- 复习时机应该基于遗忘曲线理论

**最终决策**：自定义 SM-2 变体算法

**算法核心**：
1. **遗忘指数计算**：
   - 基础：时间衰减（e^(-t/τ)）
   - 修正：复习次数、历史反馈、难度加权
   - 输出：0-100 的遗忘指数

2. **掌握状态映射**：
   - FRESH（0-30）：记忆新鲜
   - STABLE（30-50）：记忆稳定
   - WARNING（50-70）：需要关注
   - RISK（70-85）：遗忘风险
   - FORGOTTEN（85+）：需要复习

3. **复习间隔计算**：
   - 基于艾宾浩斯遗忘曲线
   - 难度调整因子
   - 动态间隔（越熟间隔越长）

**TODO**：
- [ ] 实现遗忘曲线计算器
- [ ] 编写单元测试
- [ ] 调优参数（验证不同用户群体）

---

### 2026-01-28 - 前端技术栈选择

#### [决策] React + D3.js + Three.js

**问题背景**：
- 需要2D和3D知识图谱可视化
- 需要良好的用户体验和交互

**最终决策**：
- **Web框架**：React 18
- **状态管理**：Redux Toolkit
- **2D图谱**：D3.js / Cytoscape.js
- **3D图谱**：Three.js + 3d-force-graph
- **UI组件**：Ant Design 或 Material-UI

**理由**：
1. **D3.js**：最强大的可视化库，灵活度高
2. **Cytoscape.js**：专用于图谱，有丰富的布局算法
3. **Three.js**：3D渲染的事实标准
4. **3d-force-graph**：封装了 force-directed + 3D，易于使用

**TODO**：
- [ ] 搭建 React 项目脚手架
- [ ] 集成图谱可视化组件
- [ ] 实现 2D/3D 切换功能

---

### 2026-01-28 - 开发环境配置

#### [决策] Python版本和虚拟环境选择

**决策内容**：
- **Python版本**：3.14.0（系统已安装）
- **虚拟环境**：venv（Python内置）
- **不采用**：Conda（系统未安装）

**理由**：
1. **系统环境**：Windows系统已预装 Python 3.14.0，无需额外安装
2. **简洁性**：venv 是 Python 标准库的一部分，无需安装额外工具
3. **兼容性**：避免引入 Conda 增加环境复杂度
4. **一致性**：与 Docker 容器内的开发环境保持一致

**技术细节**：
- venv路径：`NeuralNote-Project/venv/`
- Python可执行文件：`venv/Scripts/python.exe`
- .gitignore已配置：venv/ 目录被排除

**后续行动**：
- [x] ~~安装基础依赖包（fastapi, uvicorn, sqlalchemy）~~ ✅ 已安装
- [x] ~~配置代码格式化工具（black, isort）~~ ✅ 已安装
- [x] ~~配置代码检查工具（flake8, mypy）~~ ✅ 已安装
- [ ] 待完成：psycopg2（PostgreSQL驱动，需等待数据库环境配置）

---

### 2026-01-28 - 图谱风格设计

#### [决策] 提供3种预设视觉风格

**问题背景**：
- 用户审美偏好不同
- 需要差异化用户体验

**最终决策**：三种风格

1. **温馨花园风格（Warm Garden）**
   - 暖色调：粉色、橙色、绿色
   - 圆角矩形，柔和光晕
   - 曲线连线，藤蔓效果
   - 适合：喜欢温馨可爱风格的用户

2. **知识星云风格（Knowledge Nebula）**
   - 冷色调：深蓝、紫色、青色
   - 圆形/六边形，发光效果
   - 深藏青背景，星星点缀
   - 适合：喜欢科技感的用户

3. **清新现代风格（Fresh Modern）**
   - 极简设计：白色、浅灰、蓝色
   - 简洁几何形状
   - 大量留白
   - 适合：高效工作者

**TODO**：
- [ ] 设计各风格的配色方案
- [ ] 实现风格切换组件
- [ ] 添加切换动画效果

---

### 2026-01-26 - 产品命名确定

#### [决策] 产品定名为"纽伦笔记 (NeuralNote)"

**Slogan**：`Be Your Own Memory Architect. (做你自己的记忆架构师)`

**命名由来**：
- **纽**：编织、连接（象征知识之间的连接）
- **伦**：条理、次序（象征知识的结构化）
- **Note**：笔记、学习
- **Neural**：神经网络、AI智能

**备选名称**：
- 记忆架构师（太直白，缺乏记忆点）
- 知图（太简单，缺乏产品感）
- NeuralMind（已被注册）

---

### 2026-01-29 - 前端平台策略决策

#### [决策] MVP阶段专注Web端，第二阶段再考虑跨平台

**问题背景**：
- 用户询问跨平台开发的可能性和工作量
- 需要明确第一阶段和第二阶段的技术路线

**核心问题**：
1. "一套代码多端运行"是否真的能减少工作量？
2. 移动端适配需要做哪些具体工作？
3. 何时是引入跨平台框架的最佳时机？

**技术方案分析**：

1. **React Web（当前选择）**
   - 优点：D3.js/Three.js图谱功能最完整，开发效率高
   - 缺点：无法直接运行在移动端

2. **Taro（推荐方案）**
   - 优点：与React生态无缝对接，支持微信小程序
   - 缺点：图谱库需要额外适配

3. **Flutter（跨平台王者）**
   - 优点：真正一套代码，iOS/Android/Web同时支持
   - 缺点：需要学习Dart，图谱库需要重写

4. **PWA（渐进式Web应用）**
   - 优点：无需下载，自动更新
   - 缺点：iOS支持有限，性能不如原生

**最终决策**：
- **第一阶段（MVP）**：React Web
- **第二阶段**：Taro 或 Flutter（待定）

**理由**：
1. **图谱可视化优先**：MVP阶段需要完整的2D/3D图谱功能，D3.js在Web端最成熟
2. **验证核心价值**：Web端可以完整实现"上传→AI解答→图谱展示"闭环
3. **渐进式扩展**：先验证Web端，根据用户反馈再决定跨平台方案
4. **架构解耦**：后端API保持稳定，前端可渐进式演进

**工作量分析**：

| 阶段 | 平台 | 预估工作量 |
|-----|------|----------|
| 第一阶段 | Web端（React） | 核心功能开发 |
| 第二阶段 | 移动端适配 | 约59人天 |
| - | 响应式布局 | 5人天 |
| - | 触摸交互 | 7人天 |
| - | 相机功能 | 5人天 |
| - | 图谱适配 | 15人天 |
| - | UI重写 | 10人天 |

**关键洞察**：
- 移动端不是"写一次，到处运行"
- 复用部分：API调用、状态管理、业务逻辑（约30-40%）
- 需要重做部分：UI组件、交互方式、图谱适配（约60-70%）
- 预估工作量：相当于Web端的50-60%

**后续行动**：
- [ ] 完成第一阶段Web端开发
- [ ] 验证产品核心价值
- [ ] 根据用户反馈决定第二阶段技术方案
- [ ] 若选择Taro，提前调研图谱库兼容性
- [ ] 若选择Flutter，开始学习Dart语言

---

## 待办清单

### 高优先级

- [ ] 实现题目OCR识别与预处理流程
- [ ] 设计并实现知识图谱数据结构
- [ ] 开发2D知识图谱可视化组件
- [ ] 实现基础的复习提醒功能
- [ ] 搭建用户认证系统

### 中优先级

- [ ] 集成 LLM 服务（DeepSeek/GPT-4）
- [ ] 实现智能归类算法
- [ ] 开发3D知识图谱视图
- [ ] 添加多视图保存与切换功能
- [ ] 实现跨学科检测功能

### 低优先级

- [ ] 移动端适配
- [ ] 社交/社区功能
- [ ] 多设备同步
- [ ] 团队协作功能

---

## 技术债记录

| 日期 | 项目 | 描述 | 预计处理时间 |
|-----|------|------|-------------|
| 2026-01-28 | 缓存策略 | 当前未实现LLM结果缓存，需尽快补充 | V1.1 |
| 2026-01-28 | 错误处理 | OCR/AI 服务异常时的降级策略待完善 | V1.1 |
| 2026-01-28 | 性能监控 | 缺少详细的性能监控和慢查询分析 | V1.2 |

---

## 灵感收集

### 2026-01-28

- 💡 **游戏化激励**：图谱上的灰色节点可以设计为"未点亮区域"，用户复习时逐个点亮，获得成就感
- 💡 **闪念卡片**：复习时可以采用卡片翻转形式，快速过知识点，利用碎片时间
- ~~💡 **社群pk**：可以设计"知识竞赛"功能，用户之间比拼解题速度和准确率~~

### 2026-01-26

- 💡 **知识树可视化**：除了节点网络，还可以生成一棵树形结构，按教材章节组织
- 💡 **错题本导出**：支持导出为PDF格式，方便打印复习
- 💡 **语音复习**：支持语音播报题目，解放双手（通勤场景）

---

### 2026-01-29 - 前端框架选择决策

#### [决策] 采用 React + Vite + TypeScript 技术栈

**决策内容**：
- **Web框架**：React 18（使用Vite作为构建工具）
- **语言**：TypeScript（类型安全）
- **包管理器**：npm（Node.js内置）
- **项目结构**：`src/frontend/` 目录

**技术选型理由**：

1. **React 18**：
   - 生态成熟，社区活跃
   - 与D3.js/Three.js图谱库集成良好
   - 团队学习成本低

2. **Vite**：
   - 开发服务器启动快（基于原生ESM）
   - 热更新效率高
   - 打包优化内置

3. **TypeScript**：
   - 静态类型检查，减少运行时错误
   - IDE智能提示，提升开发效率
   - 代码可维护性好

4. **项目目录结构**：
   ```
   src/frontend/
   ├── public/           # 静态资源
   ├── src/              # 源代码
   │   ├── components/   # React组件
   │   ├── pages/        # 页面
   │   ├── store/        # Redux store
   │   ├── hooks/        # 自定义Hooks
   │   ├── services/     # API服务
   │   ├── utils/        # 工具函数
   │   └── styles/       # 样式文件
   ├── index.html        # 入口HTML
   ├── package.json      # 依赖配置
   ├── tsconfig.json     # TypeScript配置
   └── vite.config.ts    # Vite配置
   ```

**后续行动**：
- [x] ~~安装状态管理（Redux Toolkit）~~
- [x] ~~配置路由（React Router v6）~~
- [x] ~~安装UI组件库（Ant Design）~~
- [ ] 集成图谱可视化库（D3.js/Cytoscape.js）

---

### 2026-01-29 - 前端开发环境配置完成

---

## 术语对照表

| 中文 | 英文 | 说明 |
|-----|------|------|
| 记忆节点 | MemoryNode | 知识图谱的基本单元，可存储题目、概念等 |
| 遗忘指数 | Forgetting Index | 衡量知识点被遗忘程度的数值 (0-100) |
| 掌握状态 | Mastery Status | 基于遗忘指数的状态分类 |
| 数字指纹 | Digital Identity | AI生成的题目唯一标识 |
| 记忆点 | Memory Point | AI从解答中提取的关键技巧 |

---

*本文档由 NeuralNote 开发团队维护，持续更新中。*
*最后更新：2026-01-29 22:30*